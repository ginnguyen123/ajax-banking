<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>
    <link rel="stylesheet" href="assets/bootstrap/v5.3.0/css/bootstrap.min.css">
</head>

<body>
    <div id="toastShow">

    </div>
    <div class="container">
        <header>

        </header>

        <div class="content">
            <form method="post" id="frm-create-customer">
                <div class="row mb-3">
                    <div class="col-lg-6">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" class="form-control">
                    </div>
                    <div class="col-lg-6">
                        <label for="email">Email</label>
                        <input type="email" id="email" class="form-control">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-lg-6">
                        <label for="phone">Phone</label>
                        <input type="tel" id="phone" class="form-control">
                    </div>
                    <div class="col-lg-6">
                        <label for="address">Address</label>
                        <input type="text" id="address" class="form-control">
                    </div>
                </div>
                <div class="row mb-3">
                    <div>
                        <button type="button" id="btnCreate" class="btn btn-outline-primary">
                            Create
                        </button>
                    </div>
                </div>
            </form>

            <table id="tbCustomer" class="table table-hover" style="border: 1px solid black;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>FullName</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Address</th>
                        <th>Balance</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>
        </div>
    </div>

    <!-- modal edit -->
    <div class="modal" tabindex="-1" id="modalEditCustomer">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modal edit</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="form-group" id="frmEditCustomer">
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <label for="fullName">Full Name</label>
                                <input type="text" id="fullNameUp" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="email">Email</label>
                                <input type="email" id="emailUp" class="form-control">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <label for="phone">Phone</label>
                                <input type="tel" id="phoneUp" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="address">Address</label>
                                <input type="text" id="addressUp" class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnUpdate">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- modal deposit -->
    <div class="modal" tabindex="-1" id="modalDeposit">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modal deposit</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="form-group" id="frmDepositCustomer">
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <label for="fullName">Full Name</label>
                                <input type="text" id="fullNameDeposit" class="form-control" readonly>
                            </div>
                            <div class="col-lg-6">
                                <label for="phoneDeposit">Phone</label>
                                <input type="text" id="phoneDeposit" class="form-control" readonly>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <label for="balanceDeposit">Balance</label>
                                <input type="number" id="balanceDeposit" class="form-control" readonly>
                            </div>
                            <div class="col-lg-6">
                                <label for="transactionAmount">Transaction amount</label>
                                <input type="text" id="transactionAmount"  class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnDeposit">Deposit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- modal withdraw -->
    <div class="modal" tabindex="-1" id="modalWithdraw" >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modal deposit</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="form-group" id="frmWithdrawCustomer">
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <label for="fullName">Full Name</label>
                                <input type="text" id="fullNameWithdraw" class="form-control" readonly>
                            </div>
                            <div class="col-lg-6">
                                <label for="phoneWithdraw">Phone</label>
                                <input type="text" id="phoneWithdraw" class="form-control" readonly>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <label for="balanceDeposit">Balance</label>
                                <input type="number" id="balanceWithdraw" class="form-control" readonly>
                            </div>
                            <div class="col-lg-6">
                                <label for="transactionAmountWithdraw">Transaction amount</label>
                                <input type="text" id="transactionAmountWithdraw"  class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnWithdraw">Withdraw</button>
                </div>
            </div>
        </div>
    </div>

    <!-- modal transfer -->
    <div class="modal" tabindex="-1" id="modalTransfer" >
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modal Transfer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="form-group" id="frmTransferCustomer">
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <label for="fullName">Sender</label>
                                <input type="text" id="senderFullName" class="form-control" readonly>
                            </div>
                            <div class="col-lg-6">
                                <label for="phoneWithdraw">Balance sender</label>
                                <input type="text" id="senderBalance" class="form-control" readonly>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <label for="recipient">Recipient</label>
                                <select name="recipient" id="recipient" class="form-control">
                                    <option value="-1" selected disabled>Select recipient</option>
                                </select>
                            </div>
                            <div class="col-lg-6">
                                <label for="fees">Fees (%)</label>
                                <input type="text" id="dees" value="10"  class="form-control" readonly>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-lg-6">
                                <label for="transferAmount">Transfer amount</label>
                                <input type="text" name="transferAmount" id="transferAmount"  class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="transactionAmount">Transaction amount</label>
                                <input type="text" id="transactionAmount" name="transactionAmount" value="" class="form-control" readonly>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnTransfer">Transfer</button>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/jquery/jquery-3.6.4.min.js"></script>
    <script src="assets/bootstrap/v5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="assets/sweetalert2/sweetalert2-v11.7.3.js"></script>

    <script>
        // let customerId = 1;
        // let customers = [
        //     {
        //         id: customerId++,
        //         fullName: 'NVA',
        //         email: 'nva@co.cc',
        //         phone: '2345',
        //         address: '28 Nguyễn Tri Phương',
        //         balance: 0
        //     },
        //     {
        //         id: customerId++,
        //         fullName: 'NVB',
        //         email: 'nvb@co.cc',
        //         phone: '3456',
        //         address: '29 Nguyễn Tri Phương',
        //         balance: 0
        //     }
        // ];
        
        // let tbody = document.querySelector('#tbCustomer tbody');
        
        // $(document).ready(() => {
        //     for (let i = 0; i < $('.edit').length; i++) {
        //         $($('.edit')[i]).on('click', () => {
        //             let customerId = $($('.edit')[i]).data("id");
        //             console.log(customerId)
        //             $('#modal-edit-customer').modal('show');
        //         })
        //     }
        // })

        let currentCustomerId;
        let currentCustomer;
        let tbody = $('#tbCustomer tbody');

        function getAllCustomers() {
            $.ajax({
                type: 'GET',
                url: 'http://localhost:3300/customers'
            })
            .done((data)=>{
                $.each(data, (index, item) => {
                    if(item.deleted == "false"){
                        let str = renderCustomer(item);
                        tbody.prepend(str);
                        $('.edit').off('click');
                        $('.delete').off('click');
                        $('.deposit').off('click');
                        $('.withraw').off('click');
                        $('.transfer').off('click');

                        eventEdit();
                        eventDelete();
                        eventDeposit()
                        eventWithdraw();
                        eventTransfer();
                    }
                });

                
            })
            .fail((error)=>{
                console.log(error);
            })
        }

        function getAllRecipient(senderId){
            $.ajax({
                url: 'http://localhost:3300/customers?id_ne=' + senderId,
                type: 'GET',
            })
            .done((data)=>{
                $('#recipient').empty();
                $.each(data, (i, item) => {
                    if(item.deleted == "false"){
                        let str = renderRecipient(item);
                        $('#recipient').append(str);
                    }
                    
                })
            })
            .fail((error) => {
                console.log(error);
            })
        }
        
        function renderCustomer(customer) {
            return `
                    <tr id="tr_${customer.id}">
                        <td>${customer.id}</td>
                        <td>${customer.fullName}</td>
                        <td>${customer.email}</td>
                        <td>${customer.phone}</td>
                        <td>${customer.address}</td>
                        <td>${customer.balance}</td>
                        <td>
                            <button class="btn btn-outline-primary edit" data-id="${customer.id}">
                                <a>Edit</a>
                            </button>

                            <button class="btn btn-outline-danger delete" data-id="${customer.id}">
                                <a>Delete</a>
                            </button>

                            <button class="btn btn-outline-success deposit" data-id="${customer.id}">
                                <a>Deposit</a>
                            </button>

                            <button class="btn btn-outline-warning withraw" data-id="${customer.id}">
                                <a>Withraw</a>
                            </button>

                            <button class="btn btn-outline-info transfer" data-id="${customer.id}">
                                <a>Transfer</a>
                            </button>
                        </td>
                    </tr>
                `;
        }

        function renderToastMesseger(mes){
            return `<div class="toast hide align-items-center text-white bg-danger border-0 float-end flex-column" role="alert" data-bs-animation="true" data-bs-autohide="false" aria-live="assertive">
                        <div class="d-flex">
                        <div class="toast-body">
                            <p>
                                ${mes}
                            </p>
                        </div>
                            <button type="button" class="btn btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                    </div>`;
        }

        function renderRecipient(recipient){
            return `<option value="${recipient.id}">${recipient.fullName}</option>
            `;
        }
        
        getAllCustomers();

        $('#btnCreate').on('click', () => {
            let id;
            let fullName = $('#fullName').val();
            let email = $('#email').val();
            let phone = $('#phone').val();
            let address = $('#address').val();
            let balance = 0
            let deleted = "false";

            let customer = {
                id,
                fullName,
                email,
                phone,
                address,
                balance,
                deleted
            }
            $.ajax({
                type: 'POST',
                    headers: {
                        'accept': 'application/json',
                        'content-type': 'application/json'
                    },  
                    url: 'http://localhost:3300/customers/',
                    data: JSON.stringify(customer)
            })
            .done((data)=>{
                $('#frm-create-customer')[0].reset();

                let str = renderCustomer(customer);

                tbody.prepend(str);

                successAler("Add successful customer!!")

                $('.edit').off('click');
                $('.delete').off('click');
                $('.deposit').off('click');
                $('.withraw').off('click');
                $('.transfer').off('click');

                eventEdit();
                eventDelete();
                eventDeposit()
                eventWithdraw();
                eventTransfer();
            })
            .catch((error)=>{
                console.log(error);
                errorAler("Something wrong!");
            })

            // tbody.empty();
            // getAllCustomers();
        })

        $('#btnUpdate').on('click', ()=>{
            let fullName = $('#fullNameUp').val();
            let address = $('#addressUp').val();
            let email = $('#emailUp').val();
            let phone = $('#phoneUp').val();

            let customerUpdate = {
                id: currentCustomerId,
                fullName,
                email,
                phone,
                address,
                balance: currentCustomer.balance
            }
            $.ajax({
                type: 'PATCH',
                headers: {
                    'accept': 'application/json',
                    'content-type': 'application/json'
                },
                url: 'http://localhost:3300/customers/' + currentCustomerId,
                data: JSON.stringify(customerUpdate)
            })
            .done((data)=>{
                let str = renderCustomer(customerUpdate);

                $('#tr_' + currentCustomerId).replaceWith(str);

                $('#modalEditCustomer').modal('hide');

                successAler("Saved customer!!");

                $('.edit').off('click');
                $('.delete').off('click');
                $('.deposit').off('click');
                $('.withraw').off('click');
                $('.transfer').off('click');

                eventEdit();
                eventDelete();
                eventDeposit()
                eventWithdraw();
                eventTransfer();
            })
            .catch((error) => {
                console.log(error);
            })
        })

        $('#btnDeposit').on('click', ()=>{
            let currentBalance = +currentCustomer.balance;
            let transactionAmount = +$('#transactionAmount').val();
            
            if(isNaN(transactionAmount)){
                let str = renderToastMesseger("Need to enter numbers, not letters!");
                $('#toastShow').prepend(str);
                $('.toast').show();
                // console.log(transactionAmount);
                return;
            }

            if(transactionAmount<0){
                let str = renderToastMesseger("Enter a non-negative number");
                $('#toastShow').prepend(str);
                $('.toast').show();
                // console.log(transactionAmount);
                return;
            }

            let newBalance = currentBalance +  transactionAmount;

            // customer.balance = newBalance;

            let customer = {
                balance: newBalance
            }

            let deposit = {
                currentCustomerId,
                transactionAmount
            }

            $.ajax({
                    type: 'PATCH',
                    headers: {
                        'accept': 'application/json',
                        'content-type': 'application/json'
                    },  
                    url: 'http://localhost:3300/customers/' + currentCustomerId,
                    data: JSON.stringify(customer)
                })
                .done((data)=>{
                    $('#frmDepositCustomer')[0].reset();
                    $('#modalDeposit').modal('hide');
                    successAler('Successfully add money');

                    let str = renderCustomer(data)

                    $('#tr_' + currentCustomerId).replaceWith(str);

                    $('.edit').off('click');
                    $('.delete').off('click');
                    $('.deposit').off('click');
                    $('.withraw').off('click');
                    $('.transfer').off('click');

                    eventEdit();
                    eventDelete();
                    eventDeposit()
                    eventWithdraw();
                    eventTransfer();

                    $.ajax({
                    type: 'POST',
                    headers: {
                        'accept': 'application/json',
                        'content-type': 'application/json'
                    },  
                    url: 'http://localhost:3300/deposits',
                    data: JSON.stringify(deposit)
                    })
                })
                .catch((error)=>{
                    console.log(error);
                })

        })

        $('#btnWithdraw').on('click', ()=>{
            let currentBalance = +currentCustomer.balance;
            let transactionAmount = +$('#transactionAmountWithdraw').val();

            if(isNaN(transactionAmount)){
                let str = renderToastMesseger("Need to enter numbers, not letters!");
                    $('#modalWithdraw').prepend(str);
                    $('.toast').show();
                    console.log(transactionAmount);
                return;
            }

            if(transactionAmount<0){
                let str = renderToastMesseger("Enter a non-negative number");
                $('#modalWithdraw').prepend(str);
                $('.toast').show();
                console.log(transactionAmount);
                return;
            }

            if(transactionAmount> currentBalance){
                let str = renderToastMesseger("The amount is not enough!");
                $('#modalWithdraw').prepend(str);
                $('.toast').show();
                console.log("transactionAmount> currentBalance");
                return;
            }

            let newBalance = currentBalance - transactionAmount;

            let customer = {
                balance: newBalance
            }

            let withdraw = {
                currentCustomerId,
                transactionAmount
            }

            $.ajax({
                type: 'POST',
                headers: {
                    'accept': 'application/json',
                    'content-type': 'application/json'
                },  
                url: 'http://localhost:3300/withdraws',
                data: JSON.stringify(withdraw)
            })
            .done(()=>{
                $.ajax({
                    type: 'PATCH',
                    headers: {
                        'accept': 'application/json',
                        'content-type': 'application/json'
                    },  
                    url: 'http://localhost:3300/customers/' + currentCustomerId,
                    data: JSON.stringify(customer)
                })
                .done((data)=>{
                    $('#modalWithdraw').modal('hide');

                    $('#frmWithdrawCustomer')[0].reset();

                    successAler("Successful withdrawal!");

                    let str = renderCustomer(data);

                    $('#tr_' + currentCustomerId).replaceWith(str);

                    $('.edit').off('click');
                    $('.delete').off('click');
                    $('.deposit').off('click');
                    $('.withraw').off('click');
                    $('.transfer').off('click');

                    eventEdit();
                    eventDelete();
                    eventDeposit()
                    eventWithdraw();
                    eventTransfer();
                })

            })
            .catch((error)=>{
                console.log(error);
            })
        })
        
        $('#btnTransfer').on('click', ()=>{
            let senderId = currentCustomerId;
            let sender = currentCustomer;
            let currentBalanceSender = sender.balance;
            let transferAmount = +$('#transferAmount').val();
            let fees = 10;
            let feesAmout = transferAmount * fees / 100;
            let recipientId = $('#recipient').val();

            if (senderId === recipientId) {
                Swal.fire({
                    position: 'center',
                    icon: 'error',
                    title: 'Recipient not valid',
                    showConfirmButton: true
                })
                return;
            }
            if(sender == 'undefined'){
                return errorAler("Sender don't exist!");
            }
            if(isNaN(transferAmount)){
                let str = renderToastMesseger("Need to enter numbers, not letters!");
                    $('#modalTransfer').prepend(str);
                    $('.toast').show();
                    console.log(transactionAmount);
                return;
            }
            if(transferAmount<0){
                let str = renderToastMesseger("Enter a non-negative number");
                $('#modalTransfer').prepend(str);
                $('.toast').show();
                console.log(transactionAmount);
                return;
            }

            findCustomerById(recipientId).then((recipient)=>{
                if(recipient == 'undefined'){
                    return errorAler("Recipient don't exist!");
                }

                let transactionAmount = transferAmount + feesAmout;
                let newBlanceRecipient = +recipient.balance + transferAmount;
                let newBlanceSender = sender.balance - transferAmount;
                let newSender = {
                    balance: newBlanceSender
                }
                let newRecipient = {
                    balance: newBlanceRecipient
                }

                let transfer = {
                    senderId,
                    recipientId,
                    transferAmount,
                    fees,
                    feesAmout,
                    transactionAmount
                }

                $.ajax({
                headers: {
                    'accept': 'application/json',
                    'content-type': 'application/json'
                },
                type: 'POST',
                url: 'http://localhost:3300/transfers',
                data: JSON.stringify(transfer)
                })
                .fail((error)=>{
                    console.log(error);
                })

                // cộng tiền
                $.ajax({
                headers: {
                    'accept': 'application/json',
                    'content-type': 'application/json'
                },
                type: 'PATCH',
                url: 'http://localhost:3300/customers/' + recipientId,
                data: JSON.stringify(newRecipient)
                })
                .done((recipient)=>{
                    let str = renderCustomer(recipient);
                    $('#tr_' + recipientId).replaceWith(str);

                    $('.edit').off('click');
                    $('.delete').off('click');
                    $('.deposit').off('click');
                    $('.withraw').off('click');
                    $('.transfer').off('click');

                    eventEdit();
                    eventDelete();
                    eventDeposit()
                    eventWithdraw();
                    eventTransfer();

                })
                .fail((error)=>{
                    console.log(error);
                })
                // trừ tiền
                $.ajax({
                headers: {
                    'accept': 'application/json',
                    'content-type': 'application/json'
                },
                type: 'PATCH',
                url: 'http://localhost:3300/customers/' + senderId,
                data: JSON.stringify(newSender)
                })
                .done((newSender)=>{
                    let str = renderCustomer(newSender);
                    $('#tr_' + senderId).replaceWith(str);

                    $('.edit').off('click');
                    $('.delete').off('click');
                    $('.deposit').off('click');
                    $('.withraw').off('click');
                    $('.transfer').off('click');

                    eventEdit();
                    eventDelete();
                    eventDeposit()
                    eventWithdraw();
                    eventTransfer();
                })
                .fail((error)=>{
                    console.log(error);
                })

                successAler("Successful transaction!");
                $('#modalTransfer').modal('hide');
                $('#frmTransferCustomer')[0].reset();

            })
            .catch((error)=>{
                console.log(error);
            })

        })
        
        function eventEdit() {
            $('.edit').on('click', function(){
                let customerId = $(this).data("id");           
                findCustomerById(customerId).then((data)=>{
                    currentCustomerId = customerId;
                    currentCustomer = data;
                    if(data == 'undefined'){  
                        return errorAler("Customer don't exist!!");
                    }

                    $('#fullNameUp').val(data.fullName);
                    $('#emailUp').val(data.email);
                    $('#phoneUp').val(data.phone);
                    $('#addressUp').val(data.address);
                    $('#modalEditCustomer').modal('show');

                })
            })
        }

        function findCustomerById(id){
            return $.ajax({
                type: 'GET',
                url: 'http://localhost:3300/customers/' + id
            })
        }

        function errorAler(titles, texts){
            return Swal.fire({
                icon: 'error',
                title: titles,
                text: texts,
                // footer: '<a href="">Why do I have this issue?</a>'
                })
        }

        function successAler(titles){
            return Swal.fire({
                    position: 'center',
                    icon: 'success',
                    title: titles,
                    showConfirmButton: false,
                    timer: 1500
                })
        }

        function eventDelete() {
            $('.delete').on('click', function(){              
                let customerId = $(this).data("id");
                console.log(customerId);

                findCustomerById(customerId).then((data)=>{
                    if(data == 'undefined'){
                       return errorAler('Something wrong!');
                    }
                    currentCustomerId = customerId;

                    Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            $.ajax({
                                type: 'PATCH',
                                url: 'http://localhost:3300/customers/' + currentCustomerId,
                                data: {
                                    deleted: true
                                }
                            })
                            .done(()=>{
                                $('#tr_' + currentCustomerId).remove();
                        
                                Swal.fire(  
                                'Deleted!',
                                'Your file has been deleted.',
                                'success'
                                )
                            })
                            .fail(() => {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Oops...',
                                    text: 'Something went wrong!',
                                })
                            })
                        }
                    })
                })
                .catch((error) => {
                    console.log(error);
                });
            })
        }

        function eventDeposit(){
            $('.deposit').on('click', function(){
                let customerId = $(this).data('id');
                findCustomerById(customerId).then((data)=>{
                    if(data == 'undefined'){
                        return errorAler('Something wrong!!');
                    }
                    currentCustomerId = customerId;
                    currentCustomer = data;
                    $('#fullNameDeposit').val(data.fullName);
                    $('#phoneDeposit').val(data.phone);
                    $('#balanceDeposit').val(data.balance);
                    $('#transactionAmount').val(0);
                    $('#modalDeposit').modal('show');
                })           
            })
        }
    
        function eventWithdraw(){
            $('.withraw').on('click', function(){
                let customerId = $(this).data('id');
                findCustomerById(customerId).then((data)=>{
                    if(data == 'undefined'){
                        return errorAler("Something wrong!!");
                    }
                    currentCustomerId = customerId;
                    currentCustomer = data;
                    $('#fullNameWithdraw').val(data.fullName);
                    $('#phoneWithdraw').val(data.phone);
                    $('#balanceWithdraw').val(data.balance);
                    $('#transactionAmountWithdraw').val(0);
                    $('#modalWithdraw').modal('show');
                })
            })
        }
        
        function eventTransfer(){
            $('.transfer').on('click', function(){
                let senderId = $(this).data('id');
                findCustomerById(senderId).then((sender)=>{
                    currentCustomer = sender;
                    currentCustomerId = senderId;
                    if(sender == 'undefined'){
                        errorAler("Customer don't exist!");
                        return;
                    }
                    getAllRecipient(senderId);
                    $('#senderFullName').val(currentCustomer.fullName);
                    $('#senderBalance').val(currentCustomer.balance);
                    $('#transferAmount').val(0);
                    $('#modalTransfer').modal('show');
                })
                .catch((error)=>{
                    console.log(error);
                })
            })
        }
        
        

        $(()=>{
            $('#transferAmount').on("input", function(){
                let transferAmount = +$('#transferAmount').val();
                let fees = 10;
                let feesAmount = transferAmount * fees / 100;
                let transactionAmount = transferAmount + feesAmount;
                $('#transactionAmount').val(transactionAmount);
            })
        })
        
    </script>
</body> 

</html> 